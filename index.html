<!DOCTYPE html>
<meta charset='utf-8'>
<style>
.male {
  fill: steelblue;
}

.female {
  fill: lightpink;
}

text {
  fill: white;
  font: 12px sans-serif;
}

svg {
    margin: 0 auto;
    display: block;
}
</style>
<svg></svg>
<script src='https://d3js.org/d3.v4.min.js'></script>
<script>
d3.csv('subreddit_genders.csv',
    function(d, i, columns) {
        return d;
    }, function(error, data) {
        if (error) throw error;

        var width = 420,
            barHeight = 25;

        var x = d3.scaleLinear()
            .domain([0, 1])
            .range([0, width]);

        var chart = d3.select('svg')
            .attr('width', width)
            .attr('height', barHeight * data.length);

        var stack = d3.stack()
            .keys(['male_ratio', 'female_ratio']);
        
        var bar = chart.selectAll('g')
            .data(d3.transpose(stack(data)))
            .enter().append('g')
            .attr('transform', function(d, i) { return 'translate(0,' + i * barHeight + ')'; });

        bar.append('rect')
            .attr('class', 'male')
            .attr('x', function(d) { return x(d[0][0])})
            .attr('width', function(d) { return x(d[0][1] - d[0][0]); })
            .attr('height', barHeight - 1);
        
        bar.append('rect')
            .attr('class', 'female')
            .attr('x', function(d) { return x(d[1][0])})
            .attr('width', function(d) { return x(d[1][1] - d[1][0]); })
            .attr('height', barHeight - 1);

        bar.append('text')
            .attr('x', 6)
            .attr('y', barHeight / 2)
            .attr('dy', '.35em')
            .text(function(d) { return d[0].data.subreddit; });
});
</script>
<!DOCTYPE html>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<style>
body, html {
    margin: 0;
    padding: 0;
}

.male {
  fill: steelblue;
}

.female {
  fill: lightpink;
}

text {
  fill: white;
  font: 12px sans-serif;
}

svg {
    width: 100%;
    max-width: 420px;
    margin: 0 auto;
    display: block;
}
</style>
<svg></svg>
<script src='https://d3js.org/d3.v4.min.js'></script>
<script>
d3.csv('subreddit_genders.csv',
    function(d, i, columns) {
        return d;
    }, function(error, data) {
        if (error) throw error;

        var barHeight = 25;

        var chart = d3.select('svg')
            .attr('height', barHeight * data.length);

        var stack = d3.stack()
            .keys(['male_ratio', 'female_ratio']);
        
        var bar = chart.selectAll('g')
            .data(d3.transpose(stack(data)))
            .enter().append('g')
            .attr('transform', function(d, i) { return 'translate(0,' + i * barHeight + ')'; });

        bar.append('rect')
            .attr('class', 'male')
            .attr('x', function(d) { return 100 * d[0][0] + "%"; })
            .attr('width', function(d) { return 100 * (d[0][1] - d[0][0]) + "%"; })
            .attr('height', barHeight - 1);
        
        bar.append('rect')
            .attr('class', 'female')
            .attr('x', function(d) { return 100 * d[1][0] + "%"; })
            .attr('width', function(d) { return 100 * (d[1][1] - d[1][0]) + "%"; })
            .attr('height', barHeight - 1);

        bar.append('text')
            .attr('x', 6)
            .attr('y', barHeight / 2)
            .attr('dy', '.35em')
            .text(function(d) { return d[0].data.subreddit; });
});
</script>